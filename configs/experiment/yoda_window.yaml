# @package _global_

defaults:
  - override /data: yoda_dataset
  - override /model: yoda
  - override /callbacks: default
  - override /trainer: ddp #default
  - override /paths: default

tags: ["yoda", "video_matching"]
train: True
test: False #True
seed: 1401
ckpt_path: null

paths:
  data_dir: /var/tmp/yoda3

callbacks:
  early_stopping:
    monitor: "train/loss"
    patience: 100
    mode: "min"
  model_checkpoint:
    monitor: "train/loss"
    mode: "min"
    save_last: True
    save_top_k: 1
    auto_insert_metric_name: False
    dirpath: ${paths.output_dir}/checkpoints
    filename: "epoch_{epoch:03d}"
  model_summary:
    max_depth: 0

model:
  num_val_frames: 15
  test_nfe: 100
  plot: True

  optimizer:
    _target_: torch.optim.AdamW
    _partial_: true
    lr: 0.0001
    weight_decay: 1e-5

trainer:
  devices: 4
  strategy: ddp_find_unused_parameters_true
  #sync_batchnorm: False
  #limit_train_batches: 2
  limit_val_batches: 2
  num_sanity_val_steps: 0
#  min_epochs: 10
#  max_epochs: 10

data:
  batch_size: 1
  num_workers: 15
#
logger:
  wandb:
    tags: ${tags}
    group: "test"
  aim:
    experiment: "test"
